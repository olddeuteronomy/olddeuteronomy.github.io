<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Org Mode: Exporting Clock Tables - The Emacs Cat</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="Emacs org-mode: export a time tracker clock table to the ODT/MSWord format">
		<meta property="og:title" content="Org Mode: Exporting Clock Tables" />
<meta property="og:description" content="Emacs org-mode: export a time tracker clock table to the ODT/MSWord format" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://olddeuteronomy.github.io/post/org-export-clocktables/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-08-01T14:07:46+03:00" />
<meta property="article:modified_time" content="2023-08-01T14:07:46+03:00" />


		<meta itemprop="name" content="Org Mode: Exporting Clock Tables">
<meta itemprop="description" content="Emacs org-mode: export a time tracker clock table to the ODT/MSWord format"><meta itemprop="datePublished" content="2023-08-01T14:07:46+03:00" />
<meta itemprop="dateModified" content="2023-08-01T14:07:46+03:00" />
<meta itemprop="wordCount" content="1568">
<meta itemprop="keywords" content="emacs,elisp,org-mode," />
		<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Org Mode: Exporting Clock Tables"/>
<meta name="twitter:description" content="Emacs org-mode: export a time tracker clock table to the ODT/MSWord format"/>

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/custom.css">

	<link rel="shortcut icon" href="/favicon.ico">
        
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo logo--mixed">
		<a class="logo__link" href="/" title="The Emacs Cat" rel="home">
			<div class="logo__item logo__imagebox">
					<img class="logo__img" src="/img/od.png">
				</div><div class="logo__item logo__text">
					<div class="logo__title">The Emacs Cat</div>
					<div class="logo__tagline">An Emacser&#39;s Miscellany</div>
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/about/">
				
				<span class="menu__text">About</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Org Mode: Exporting Clock Tables</h1>
			<div class="post__meta meta"><div class="meta__item-author meta__item">
	<svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 12 16"><path d="M6 1c2.2 0 3.5 2 3.5 4.5C9.5 7 8.9 8.2 8 9c2.9.8 4 2.5 4 5v1H0v-1c0-2.5 1.1-4.2 4-5-.9-.8-1.5-2-1.5-3.5C2.5 3 3.8 1 6 1z"/></svg><span class="meta__text">The Emacs Cat</span>
</div>
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2023-08-01T14:07:46&#43;03:00">Tuesday, Aug 1, 2023</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg><span class="meta__text"><a class="meta__link" href="/categories/2023/" rel="category">2023</a>
	</span>
</div></div>
		</header>
		<div class="content post__content clearfix">
			<p>After reading a quite interesting post by Irreal on <a href="https://irreal.org/blog/?p=11416">Org mode clock tables</a>,
I decided to share my — a bit specific —  experience with the subject.</p>
<h2 id="the-task">The Task</h2>
<p>Like many of us these days, I&rsquo;m working remotely. My employer requires
a periodic report and I should track my time I spend on various task —
exactly as Irreal describes in his post. Of course, I&rsquo;m using Org mode
clock tables for that purpose.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-org" data-lang="org"><span style="display:flex;"><span><span style="color:#75715e">#+TITLE</span><span style="color:#75715e">: Worktime Tracker for July 2023</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#+OPTIONS</span><span style="color:#75715e">: num:nil toc:nil</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#+BEGIN</span><span style="color:#75715e">: clocktable :maxlevel 3 :scope file</span>
</span></span><span style="display:flex;"><span>#+END
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>*<span style="font-weight:bold"> 2023-07   </span><span style="font-style:italic"> :2023:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">**</span> 2023-07-03
</span></span><span style="display:flex;"><span><span style="color:#75715e">***</span> Impl. a test gRPC server                           <span style="font-style:italic"> :TEST:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">:LOGBOOK:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">CLOCK: [2023-07-03 Mon 15:05]--[2023-07-03 Mon 15:50] =&gt;  0:45
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">CLOCK: [2023-07-03 Mon 09:45]--[2023-07-03 Mon 14:10] =&gt;  4:25
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">:END:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">**</span> 2023-07-04
</span></span><span style="display:flex;"><span><span style="color:#75715e">***</span> Fix client timeout                                  <span style="font-style:italic"> :FIX:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">:LOGBOOK:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">CLOCK: [2023-07-04 Tue 12:45]--[2023-07-04 Tue 13:10] =&gt;  0:25
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">:END:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">***</span> Add AddOrder handler                               <span style="font-style:italic"> :FEAT:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">:LOGBOOK:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">CLOCK: [2023-07-04 Tue 14:05]--[2023-07-04 Tue 15:10] =&gt;  1:05
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">:END:</span>
</span></span></code></pre></div><p>Then if I put the cursor at the line with the word <code>#+BEGIN</code> (line #4
in my org file) and press <code>C-c C-c</code> (in the Org mode, this chord runs
the multipurpose command <code>org-ctrl-c-ctrl-c</code>), the dynamic clock table
block is getting updated immediately and I get a standard clock table
report as shown below.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-org" data-lang="org"><span style="display:flex;"><span><span style="color:#75715e">#+BEGIN</span><span style="color:#75715e">: clocktable :maxlevel 3 :scope file</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#+CAPTION</span><span style="color:#75715e">: Clock summary at [2023-07-30 Sun 15:32]</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">| Headline                       | Time |      |      |</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">|--------------------------------+------+------+------|</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">| *Total time*                   |*6:40*|      |      |</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">|--------------------------------+------+------+------|</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">| 2023-07                        | 6:40 |      |      |</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">| \_  2023-07-03                 |      | 5:10 |      |</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">| \_    Impl. a test gRPC server |      |      | 5:10 |</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">| \_  2023-07-04                 |      | 1:30 |      |</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">| \_    Fix client timeout       |      |      | 0:25 |</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">| \_    Add AddOrder handler     |      |      | 1:05 |</span>
</span></span><span style="display:flex;"><span>#+END
</span></span></code></pre></div><p>So far, everything looks fine.</p>
<h2 id="the-problem">The Problem</h2>
<p>The problem is that my employer wants the report to be in a specific
format.</p>
<figure><img src="/img/clock-report.png"/><figcaption>
            <h4>The required MS Word (sic!) file with the work time report.</h4>
        </figcaption>
</figure>

<p>Please note the column #1 should contain <em>a tag</em> of the task, all dates
should be in the <em>DD.MM.YYYY</em> format, a time spent for the task should
be in the <em>hh:mm</em> format, left-padded with 0s if required, and the
total time should be in the <em>hhh:mm</em> format, left-padded with 0s as
well.</p>
<p>Here the adventure begins.</p>
<h2 id="the-adventure">The Adventure</h2>
<p>I decided to implement my <em>exporter</em> as the Elisp code block inside my
time tracking org file. Therefore, if I press <code>C-c C-c</code> when the
cursor is over the <em>exporter</em> code block, Emacs evaluates this block
and prints the result just below the block. This would allow us to
make some experiments.</p>
<p>First of all, I need an access to my clock table entries. After some
research I found what I need — <code>org-clock-get-table-data</code>, a built-in
function defined in the <code>org-clock.el[.gz]</code> file (as of Emacs 28.2).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(defun org-clock-get-table-data (file params)
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Get the clocktable data for file FILE, with parameters PARAMS.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">FILE is only for identification - this function assumes that
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">the correct buffer is current, and that the wanted restriction is
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">in place.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">The return value will be a list with the file name and the total
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">file time (in minutes) as 1st and 2nd elements.  The third element
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">of this list will be a list of headline entries.  Each entry has the
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">following structure:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  (LEVEL HEADLINE TAGS TIMESTAMP TIME PROPERTIES)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LEVEL:      The level of the headline, as an integer.  This will be
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            the reduced level, so 1,2,3,... even if only odd levels
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            are being used.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">HEADLINE:   The text of the headline.  Depending on PARAMS, this may
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            already be formatted like a link.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TAGS:       The list of tags of the headline.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TIMESTAMP:  If PARAMS require it, this will be a time stamp found in the
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            entry, any of SCHEDULED, DEADLINE, NORMAL, or first inactive,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            in this sequence.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TIME:       The sum of all time spend in this tree, in minutes.  This time
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            will of cause be restricted to the time block and tags match
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            specified in PARAMS.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">PROPERTIES: The list properties specified in the `:properties&#39; parameter
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            along with their value, as an alist following the pattern
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            (NAME . VALUE).&#34;</span>
</span></span></code></pre></div><p>Let&rsquo;s make an experiment.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+begin_src elisp
</span></span><span style="display:flex;"><span>(org-clock-get-table-data <span style="color:#a6e22e">buffer-file-name</span> <span style="color:#f92672">&#39;</span>(:tags <span style="color:#66d9ef">t</span>))
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+end_src
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+RESULTS:
</span></span><span style="display:flex;"><span>| /home/magnolia/Desktop/demo.org | <span style="color:#ae81ff">400</span> | ((<span style="color:#ae81ff">1</span> 2023-07 (<span style="color:#ae81ff">2023</span>) <span style="color:#66d9ef">nil</span> <span style="color:#ae81ff">400</span> <span style="color:#66d9ef">nil</span>) (<span style="color:#ae81ff">2</span> 2023-07-03 (<span style="color:#ae81ff">2023</span>) <span style="color:#66d9ef">nil</span> <span style="color:#ae81ff">310</span> <span style="color:#66d9ef">nil</span>) (<span style="color:#ae81ff">3</span> Impl. a test gRPC server (<span style="color:#ae81ff">2023</span> TEST) <span style="color:#66d9ef">nil</span> <span style="color:#ae81ff">310</span> <span style="color:#66d9ef">nil</span>) (<span style="color:#ae81ff">2</span> 2023-07-04 (<span style="color:#ae81ff">2023</span>) <span style="color:#66d9ef">nil</span> <span style="color:#ae81ff">90</span> <span style="color:#66d9ef">nil</span>) (<span style="color:#ae81ff">3</span> Fix client timeout (<span style="color:#ae81ff">2023</span> FIX) <span style="color:#66d9ef">nil</span> <span style="color:#ae81ff">25</span> <span style="color:#66d9ef">nil</span>) (<span style="color:#ae81ff">3</span> Add AddOrder handler (<span style="color:#ae81ff">2023</span> FEAT) <span style="color:#66d9ef">nil</span> <span style="color:#ae81ff">65</span> <span style="color:#66d9ef">nil</span>)) |
</span></span></code></pre></div><p>Please note the output is an Org table because the result is a list.
Please also note the <code>'(:tags t)</code> parameter — it is required because
we want all tags to be included in the output.</p>
<p>Obviously, we actually want the 3rd element of the output list.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+begin_src elisp
</span></span><span style="display:flex;"><span>(<span style="color:#a6e22e">nth</span> <span style="color:#ae81ff">2</span> (org-clock-get-table-data <span style="color:#a6e22e">buffer-file-name</span> <span style="color:#f92672">&#39;</span>(:tags <span style="color:#66d9ef">t</span>)))
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+end_src
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+RESULTS:
</span></span><span style="display:flex;"><span>| <span style="color:#ae81ff">1</span> |                  2023-07 | (<span style="color:#ae81ff">2023</span>)      | <span style="color:#66d9ef">nil</span> | <span style="color:#ae81ff">400</span> | <span style="color:#66d9ef">nil</span> |
</span></span><span style="display:flex;"><span>| <span style="color:#ae81ff">2</span> |               2023-07-03 | (<span style="color:#ae81ff">2023</span>)      | <span style="color:#66d9ef">nil</span> | <span style="color:#ae81ff">310</span> | <span style="color:#66d9ef">nil</span> |
</span></span><span style="display:flex;"><span>| <span style="color:#ae81ff">3</span> | Impl. a test gRPC server | (<span style="color:#ae81ff">2023</span> TEST) | <span style="color:#66d9ef">nil</span> | <span style="color:#ae81ff">310</span> | <span style="color:#66d9ef">nil</span> |
</span></span><span style="display:flex;"><span>| <span style="color:#ae81ff">2</span> |               2023-07-04 | (<span style="color:#ae81ff">2023</span>)      | <span style="color:#66d9ef">nil</span> |  <span style="color:#ae81ff">90</span> | <span style="color:#66d9ef">nil</span> |
</span></span><span style="display:flex;"><span>| <span style="color:#ae81ff">3</span> |       Fix client timeout | (<span style="color:#ae81ff">2023</span> FIX)  | <span style="color:#66d9ef">nil</span> |  <span style="color:#ae81ff">25</span> | <span style="color:#66d9ef">nil</span> |
</span></span><span style="display:flex;"><span>| <span style="color:#ae81ff">3</span> |     Add AddOrder handler | (<span style="color:#ae81ff">2023</span> FEAT) | <span style="color:#66d9ef">nil</span> |  <span style="color:#ae81ff">65</span> | <span style="color:#66d9ef">nil</span> |
</span></span></code></pre></div><p>It seems we are on the right way. The column #1 contains the level of
the headline, as an integer; #2 — the text of the headline; #3 — the
list of tags of the headline; #5 — the sum of all time spend in this
tree, in minutes, as an integer.</p>
<h3 id="the-magic">The Magic</h3>
<p>Before implementing the clock table parser, we need some <em>utilities</em>.</p>
<p>First of all we should convert a date from the ISO 8601 format
(YYYY-MM-DD) to the European DD.MM.YYYY format.
According to the <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Time-Parsing.html">GNU Emacs Lisp Reference Manual</a>,
we can use two built-in functions for this purpose:</p>
<blockquote>
<p>Function: <code>format-time-string</code> <em>format-string &amp;optional time zone</em></p>
<p>This function converts <em>time</em> (which should be a Lisp <strong>timestamp</strong>,
and defaults to the current time if time is omitted or nil) to a
string according to format-string.</p>
</blockquote>
<p>and</p>
<blockquote>
<p>Function: <code>date-to-time</code> <em>string</em></p>
<p>This function parses the time-string <em>string</em> and returns the
corresponding Lisp <strong>timestamp</strong>.
This function assumes Universal Time if <em>string</em> lacks explicit time zone information,
and <em>assumes earliest values if string lacks month, day, or time</em>.</p>
</blockquote>
<p>As we&rsquo;ll see below, the last sentence (in italic) is wrong — at least as of Emacs
28.2. Maybe it has something to do with
<a href="https://debbugs.gnu.org/cgi/bugreport.cgi?bug=52209">this bug in Emacs 28</a>,
I don&rsquo;t know.</p>
<p>Okay, let&rsquo;s test it out.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+begin_src elisp
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">format-time-string</span> <span style="color:#e6db74">&#34;%d.%m.%Y&#34;</span> (date-to-time <span style="color:#e6db74">&#34;2023-07&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+end_src
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Error: date-to-time: Invalid date: 2023-07
</span></span></code></pre></div><p>This doesn&rsquo;t work.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+begin_src elisp
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">format-time-string</span> <span style="color:#e6db74">&#34;%d.%m.%Y&#34;</span> (date-to-time <span style="color:#e6db74">&#34;2023-07-04&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+end_src
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Error: date-to-time: Invalid date: 2023-07-04
</span></span></code></pre></div><p>This doesn&rsquo;t work as well.</p>
<p>This is where the magic begins. Let&rsquo;s add <em>a fake time component</em>
<code>T01</code> to the ISO date string.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+begin_src elisp
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">format-time-string</span> <span style="color:#e6db74">&#34;%d.%m.%Y&#34;</span> (date-to-time <span style="color:#e6db74">&#34;2023-07-04T01&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+end_src
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+RESULTS:
</span></span><span style="display:flex;"><span><span style="color:#f92672">:</span> 04.07.2023
</span></span></code></pre></div><p>It worked, I&rsquo;m so happy.</p>
<p>Now let&rsquo;s implement a utility function that converts a time, in
minutes, as an integer, to the properly padded  string.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+begin_src elisp
</span></span><span style="display:flex;"><span>  (defun my/clock--format-time (time-in-minutes <span style="color:#66d9ef">&amp;optional</span> padding)
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Convert TIME-IN-MINUTES, as an integer, to a string,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   with hours left-padded with zeroes. Default PADDING is 2.&#34;</span>
</span></span><span style="display:flex;"><span>    (let* ((hours (<span style="color:#a6e22e">/</span> time-in-minutes <span style="color:#ae81ff">60</span>))
</span></span><span style="display:flex;"><span>           (minutes (<span style="color:#a6e22e">-</span> time-in-minutes (<span style="color:#a6e22e">*</span> hours <span style="color:#ae81ff">60</span>))))
</span></span><span style="display:flex;"><span>      (<span style="color:#a6e22e">format</span> (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34;%0&#34;</span> (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;%d&#34;</span> (or padding <span style="color:#ae81ff">2</span>)) <span style="color:#e6db74">&#34;d:%02d&#34;</span>)
</span></span><span style="display:flex;"><span>               hours minutes)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">;; TEST</span>
</span></span><span style="display:flex;"><span>(my/clock--format-time <span style="color:#ae81ff">310</span>)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+end_src
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+RESULTS:
</span></span><span style="display:flex;"><span><span style="color:#f92672">:</span> 05:10
</span></span></code></pre></div><p>Okay, it works.</p>
<h2 id="the-result">The Result</h2>
<p>Now let&rsquo;s combine everything together and then evaluate the code
block.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+begin_src elisp
</span></span><span style="display:flex;"><span>  (require <span style="color:#e6db74">&#39;org-clock</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (defvar my/cur-date <span style="color:#66d9ef">nil</span> <span style="color:#e6db74">&#34;Holds the current entry date.&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (defun my/clock--format-time (time-in-minutes <span style="color:#66d9ef">&amp;optional</span> padding)
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Convert TIME-IN-MINUTES, as an integer, to a string,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   with hours left-padded with zeroes. Default PADDING is 2.&#34;</span>
</span></span><span style="display:flex;"><span>    (let* ((hours (<span style="color:#a6e22e">/</span> time-in-minutes <span style="color:#ae81ff">60</span>))
</span></span><span style="display:flex;"><span>           (minutes (<span style="color:#a6e22e">-</span> time-in-minutes (<span style="color:#a6e22e">*</span> hours <span style="color:#ae81ff">60</span>))))
</span></span><span style="display:flex;"><span>      (<span style="color:#a6e22e">format</span> (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34;%0&#34;</span> (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;%d&#34;</span> (or padding <span style="color:#ae81ff">2</span>)) <span style="color:#e6db74">&#34;d:%02d&#34;</span>)
</span></span><span style="display:flex;"><span>               hours minutes)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  (defun my/clock--parse-entry (entry)
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Parse the clock table ENTRY, returning a list of row items,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   depending on the level of the headline.&#34;</span>
</span></span><span style="display:flex;"><span>    (let* ((level (<span style="color:#a6e22e">car</span> entry))
</span></span><span style="display:flex;"><span>           (headline (<span style="color:#a6e22e">nth</span> <span style="color:#ae81ff">1</span> entry))
</span></span><span style="display:flex;"><span>           (tag (<span style="color:#a6e22e">nth</span> <span style="color:#ae81ff">1</span> (<span style="color:#a6e22e">nth</span> <span style="color:#ae81ff">2</span> entry)))
</span></span><span style="display:flex;"><span>           (minutes (<span style="color:#a6e22e">nth</span> <span style="color:#ae81ff">4</span> entry))
</span></span><span style="display:flex;"><span>           (date (if (<span style="color:#a6e22e">=</span> level <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>                     (<span style="color:#a6e22e">format-time-string</span> <span style="color:#e6db74">&#34;%d.%m.%Y&#34;</span>
</span></span><span style="display:flex;"><span>                         (date-to-time (<span style="color:#a6e22e">concat</span> headline <span style="color:#e6db74">&#34;T01&#34;</span>))))))
</span></span><span style="display:flex;"><span>      (cond
</span></span><span style="display:flex;"><span>        ((<span style="color:#a6e22e">=</span> level <span style="color:#ae81ff">1</span>) (<span style="color:#a6e22e">list</span> headline <span style="color:#e6db74">&#34;TOTAL&#34;</span> <span style="color:#e6db74">&#34;&#34;</span> (my/clock--format-time minutes <span style="color:#ae81ff">3</span>)))
</span></span><span style="display:flex;"><span>        ((<span style="color:#a6e22e">=</span> level <span style="color:#ae81ff">2</span>) (progn (setq my/cur-date date) <span style="color:#66d9ef">nil</span>))
</span></span><span style="display:flex;"><span>        ((<span style="color:#a6e22e">=</span> level <span style="color:#ae81ff">3</span>) (<span style="color:#a6e22e">list</span> tag headline my/cur-date (my/clock--format-time minutes)))
</span></span><span style="display:flex;"><span>      )))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">;; Apply the parser to every entry in the clock table.</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">mapcar</span> <span style="color:#a6e22e">#&#39;</span>my/clock--parse-entry
</span></span><span style="display:flex;"><span>     (<span style="color:#a6e22e">nth</span> <span style="color:#ae81ff">2</span> (org-clock-get-table-data <span style="color:#a6e22e">buffer-file-name</span> <span style="color:#f92672">&#39;</span>(:tags <span style="color:#66d9ef">t</span>))))
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+end_src
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">#</span>+RESULTS:
</span></span><span style="display:flex;"><span>| 2023-07 | TOTAL                    |            | 006:40 |
</span></span><span style="display:flex;"><span>| TEST    | Impl. a test gRPC server | 03.07.2023 |  05:10 |
</span></span><span style="display:flex;"><span>| FIX     | Fix client timeout       | 04.07.2023 |  00:25 |
</span></span><span style="display:flex;"><span>| FEAT    | Add AddOrder handler     | 04.07.2023 |  01:05 |
</span></span></code></pre></div><p>Bingo! We&rsquo;ve got what we exactly want — the Org mode table filled with
properly formatted data. Now I can just copy this table from my work
time org file to another org file and export it to the ODT file (and
then save it as the MS Word file).</p>
<figure><img src="/img/clock-report.png"/><figcaption>
            <h4>The MS Word file with the work time report.</h4>
        </figcaption>
</figure>

<p>Tested on Ubuntu Linux (Pop!_OS 20.10) and MS Windows 10 using Emacs 28.2.</p>
<h2 id="conclusions">Conclusions</h2>
<ol>
<li>We can have access to all the data collected in a clock table.</li>
<li>Org mode code blocks provide an ideal way to make experiments,
testing your code, and getting the result <em>inplace</em>.</li>
<li>In Emacs, you can do everything.</li>
</ol>
<p>Happy emacsing!</p>
		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/emacs/" rel="tag">emacs</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/elisp/" rel="tag">elisp</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/org-mode/" rel="tag">org-mode</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>



<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/post/a-tree-sitter-config-that-works/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">A Simple tree-sitter Config That Works</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/post/some-excerpts-from-my-emacs-config/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Some Excerpts From My Emacs Config</p>
		</a>
	</div>
</nav>

<section class="comments">
	<div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "olddeuteronomy" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


			</div>
			<aside class="sidebar"><div class="widget-search widget">
	<form class="widget-search__form" role="search" method="get" action="https://duckduckgo.com/">
		<label>
			<input class="widget-search__field" type="search" placeholder="SEARCH…" value="" name="q" aria-label="SEARCH…">
		</label>
		<input class="widget-search__submit" type="submit" value="Search">
		<input type="hidden" name="sites" value="https://olddeuteronomy.github.io/"/>
	</form>
</div>
<div class="widget-recent widget">
	<h4 class="widget__title">Recent Posts</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/post/emacs-window-navigation/">Windows Navigation in Emacs</a></li>
			<li class="widget__item"><a class="widget__link" href="/post/emacs-time-stamp/">Emacs Time Stamp</a></li>
			<li class="widget__item"><a class="widget__link" href="/post/elfeed-optimized-blogging/">Elfeed-optimized Blogging</a></li>
			<li class="widget__item"><a class="widget__link" href="/post/orgmode-for-reproducibility-testing/">Using Emacs Org Mode for Reproducibility Testing</a></li>
			<li class="widget__item"><a class="widget__link" href="/post/cpp-programming-in-emacs/">C&#43;&#43; Programming in Emacs</a></li>
		</ul>
	</div>
</div>
<div class="widget-taglist widget">
	<h4 class="widget__title">Tags</h4>
	<div class="widget__content">
		<a class="widget-taglist__link widget__link btn" href="/tags/blog/" title="Blog">Blog</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/c&#43;&#43;/" title="C&#43;&#43;">C&#43;&#43;</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/calc/" title="Calc">Calc</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/config/" title="Config">Config</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/elfeed/" title="Elfeed">Elfeed</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/elisp/" title="Elisp">Elisp</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/emacs/" title="Emacs">Emacs</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/eshell/" title="Eshell">Eshell</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/org-mode/" title="Org-Mode">Org-Mode</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/packages/" title="Packages">Packages</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/pages/" title="Pages">Pages</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/python/" title="Python">Python</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/snippets/" title="Snippets">Snippets</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/social/" title="Social">Social</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/tree-sitter/" title="Tree-Sitter">Tree-Sitter</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/writing/" title="Writing">Writing</a>
	</div>
</div>
<div class="widget-categories widget">
	<h4 class="widget__title">Categories</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item">
				<a class="widget__link" href="/categories/2017/">2017</a>&nbsp;
				<span class="widget__counter widget__counter--bubble">1</span>
				</li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/2022/">2022</a>&nbsp;
				<span class="widget__counter widget__counter--bubble">8</span>
				</li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/2023/">2023</a>&nbsp;
				<span class="widget__counter widget__counter--bubble">1</span>
				</li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/2024/">2024</a>&nbsp;
				<span class="widget__counter widget__counter--bubble">5</span>
				</li>
			<li class="widget__item">
				<a class="widget__link" href="/categories/2025/">2025</a>&nbsp;
				<span class="widget__counter widget__counter--bubble">5</span>
				</li>
		</ul>
	</div>
</div>
<div class="widget-social widget">
	<h4 class="widget-social__title widget__title">Social</h4>
	<div class="widget-social__content widget__content">
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="GitHub" rel="noopener noreferrer" href="https://github.com/olddeuteronomy" target="_blank">
				<svg class="widget-social__link-icon icon icon-github" width="24" height="24" viewBox="0 0 384 374"><path d="m192 0c-106.1 0-192 85.8-192 191.7 0 84.7 55 156.6 131.3 181.9 9.6 1.8 13.1-4.2 13.1-9.2 0-4.6-.2-16.6-.3-32.6-53.4 11.6-64.7-25.7-64.7-25.7-8.7-22.1-21.3-28-21.3-28-17.4-11.9 1.3-11.6 1.3-11.6 19.3 1.4 29.4 19.8 29.4 19.8 17.1 29.3 44.9 20.8 55.9 15.9 1.7-12.4 6.7-20.8 12.2-25.6-42.6-4.8-87.5-21.3-87.5-94.8 0-20.9 7.5-38 19.8-51.4-2-4.9-8.6-24.3 1.9-50.7 0 0 16.1-5.2 52.8 19.7 15.3-4.2 31.7-6.4 48.1-6.5 16.3.1 32.7 2.2 48.1 6.5 36.7-24.8 52.8-19.7 52.8-19.7 10.5 26.4 3.9 45.9 1.9 50.7 12.3 13.4 19.7 30.5 19.7 51.4 0 73.7-44.9 89.9-87.7 94.6 6.9 5.9 13 17.6 13 35.5 0 25.6-.2 46.3-.2 52.6 0 5.1 3.5 11.1 13.2 9.2 76.2-25.5 131.2-97.3 131.2-182 0-105.9-86-191.7-192-191.7z"/></svg>
				<span>GitHub</span>
			</a>
		</div>

		
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="X" rel="noopener noreferrer" href="https://x.com/ODeuteronomy" target="_blank">
					<svg class="widget-social__link-icon icon icon-rss" width="24" height="24" viewBox="0 0 24 24"><path d="M14.095479,10.316482L22.286354,1h-1.940718l-7.115352,8.087682L7.551414,1H1l8.589488,12.231093L1,23h1.940717  l7.509372-8.542861L16.448587,23H23L14.095479,10.316482z M11.436522,13.338465l-0.871624-1.218704l-6.924311-9.68815h2.981339  l5.58978,7.82155l0.867949,1.218704l7.26506,10.166271h-2.981339L11.436522,13.338465z"/></svg>

				<span>X</span>
			</a>
		</div>
		
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="Bluesky" rel="noopener noreferrer" href="https://bsky.app/profile/olddeuteronomy.bsky.social" target="_blank">
					<svg class="widget-social__link-icon icon icon-rss" width="24" height="24" viewBox="0 -3.268 64 68.414"><path d="M13.873 3.805C21.21 9.332 29.103 20.537 32 26.55v15.882c0-.338-.13.044-.41.867-1.512 4.456-7.418 21.847-20.923 7.944-7.111-7.32-3.819-14.64 9.125-16.85-7.405 1.264-15.73-.825-18.014-9.015C1.12 23.022 0 8.51 0 6.55 0-3.268 8.579-.182 13.873 3.805zm36.254 0C42.79 9.332 34.897 20.537 32 26.55v15.882c0-.338.13.044.41.867 1.512 4.456 7.418 21.847 20.923 7.944 7.111-7.32 3.819-14.64-9.125-16.85 7.405 1.264 15.73-.825 18.014-9.015C62.88 23.022 64 8.51 64 6.55c0-9.818-8.578-6.732-13.873-2.745z"/></svg>
				<span>Bluesky</span>
			</a>
		</div>
		
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="Mastodon" rel="noopener noreferrer" href="https://mastodon.social/@olddeuteronomy" target="_blank">
					<svg class="widget-social__link-icon icon icon-rss" width="24" height="24" viewBox="0 0 24 24"><path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"/></svg>

				<span>Mastodon</span>
			</a>
		</div>
		
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="RSS" rel="noopener noreferrer" href="https://olddeuteronomy.github.io/index.xml" target="_blank">
					<svg class="widget-social__link-icon icon icon-rss" width="24" height="24" viewBox="0 0 448 512"><path d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"/></svg>

				<span>RSS</span>
			</a>
		</div>
		
	</div>
</div>
</aside>
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2025 The Emacs Cat.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>
